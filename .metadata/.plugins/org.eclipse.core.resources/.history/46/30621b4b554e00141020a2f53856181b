package br.usjt.aepn2012.cardroiduino.ui;

import br.usjt.aepn2012.cardroiduino.R;
import br.usjt.aepn2012.cardroiduino.db.CarDroiDuinoDbAdapter;
import br.usjt.aepn2012.cardroiduino.utils.SystemProperties;
import android.app.Activity;
import android.database.Cursor;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;

/**
 * <p>
 * <b>Description:</b> <br>
 * <p>
 * Display the System Properties - Has the main properties for Communication
 * between the client and server elements
 * 
 * 
 */
public class SystemPropertiesActivity extends Activity {

	/**
	 * Server IP field ( Anbdroid Car)
	 */
	private EditText txtIPServer;

	/**
	 * Server Port field
	 */
	private EditText txtPortServer;

	/**
	 * Client IP field (Remote Control )
	 */
	private EditText txtIPClient;

	/**
	 * Helper to manage the connection SqlLite
	 */
	private CarDroiDuinoDbAdapter carDroiDuinoDbAdapter;

	/**
	 * Port field Car
	 */
	private EditText txtPortClient;

	/**
	 * Executed method to initialize the class
	 */
	@Override
	protected void onCreate(Bundle savedInstanceState) {

		super.onCreate(savedInstanceState);

		// *************************************************
		// Which by setting the Layout ( XML ) Activity associated with this - >
		// CarDroiDuino \ res \ layout
		setContentView(R.layout.properties_layout);

		// *************************************************
		// Capturando e configurando objetos da tela
		this.txtIPServer = (EditText) findViewById(R.id.txtIPServer);
		this.txtPortServer = (EditText) findViewById(R.id.txtPortServer);
		this.txtIPClient = (EditText) findViewById(R.id.txtIPClient);
		this.txtPortClient = (EditText) findViewById(R.id.txtPortClient);
		Button btnSalvar = (Button) findViewById(R.id.btnSalvar);
		btnSalvar.setOnClickListener(new View.OnClickListener() {
			public void onClick(View v) {
				// ******************************************
				// Listener do bot�o - Salva os dados e fecha a janela ao Clicar
				// no Bot�o
				saveFields();
				finish();
			}
		});

		// *************************************************
		// Inicializando Conex�o ao Banco de Dados
		this.carDroiDuinoDbAdapter = new CarDroiDuinoDbAdapter(this);
		this.carDroiDuinoDbAdapter.open();

		// *************************************************
		// Populando Campos
		this.populateFields();
	}

	/**
	 * Popula os Campos para exibir os dados cadastrados
	 */
	private void populateFields() {

		Cursor cursor;
		// *************************************************
		// Buscando IP do Server
		cursor = this.carDroiDuinoDbAdapter
				.fetchPropertie(SystemProperties.PROPERTIE_ID_IPADDRESS_SERVER);
		startManagingCursor(cursor);
		this.txtIPServer.setText(cursor.getString(cursor
				.getColumnIndexOrThrow(SystemProperties.DATABASE_FIELD_PROP)));

		cursor = null;
		// *************************************************
		// Buscando Porta do Server
		cursor = this.carDroiDuinoDbAdapter
				.fetchPropertie(SystemProperties.PROPERTIE_ID_PORT_SERVER);
		startManagingCursor(cursor);
		this.txtPortServer.setText(cursor.getString(cursor
				.getColumnIndexOrThrow(SystemProperties.DATABASE_FIELD_PROP)));

		cursor = null;
		// *************************************************
		// Buscando IP do Client
		cursor = this.carDroiDuinoDbAdapter
				.fetchPropertie(SystemProperties.PROPERTIE_ID_IPADDRESS_CLIENT);
		startManagingCursor(cursor);
		this.txtIPClient.setText(cursor.getString(cursor
				.getColumnIndexOrThrow(SystemProperties.DATABASE_FIELD_PROP)));

		cursor = null;
		// *************************************************
		// Buscando Porta do Client
		cursor = this.carDroiDuinoDbAdapter
				.fetchPropertie(SystemProperties.PROPERTIE_ID_PORT_CLIENT);
		startManagingCursor(cursor);
		this.txtPortClient.setText(cursor.getString(cursor
				.getColumnIndexOrThrow(SystemProperties.DATABASE_FIELD_PROP)));
	}

	/**
	 * Salva os campos editados
	 */
	private void saveFields() {
		// *************************************************
		// Salvando IP do Server
		this.carDroiDuinoDbAdapter.updatePropertie(
				SystemProperties.PROPERTIE_ID_IPADDRESS_SERVER,
				this.txtIPServer.getText().toString());

		// *************************************************
		// Salvando Porta do Server
		this.carDroiDuinoDbAdapter.updatePropertie(
				SystemProperties.PROPERTIE_ID_PORT_SERVER, this.txtPortServer
						.getText().toString());

		// *************************************************
		// Salvando IP do Client
		this.carDroiDuinoDbAdapter.updatePropertie(
				SystemProperties.PROPERTIE_ID_IPADDRESS_CLIENT,
				this.txtIPClient.getText().toString());

		// *************************************************
		// Salvando Porta do Client
		this.carDroiDuinoDbAdapter.updatePropertie(
				SystemProperties.PROPERTIE_ID_PORT_CLIENT, this.txtPortClient
						.getText().toString());

	}

}
